<Window x:Class="yShorts.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:yShorts.Converters"
        Title="yShorts — Studio"
        Icon="favicon.ico"
        Width="1100" Height="850"
        MinWidth="900" MinHeight="700"
        WindowStartupLocation="CenterScreen"
        Background="#F3F4F6"
        FontFamily="Segoe UI Variable, Segoe UI, Inter, Roboto, sans-serif">

    <Window.Resources>
        <conv:CountToVisibilityConverter x:Key="CountToVisibilityConverter"/>
        
        <!-- Modern Light Theme Palette -->
        <SolidColorBrush x:Key="PrimaryBrush" Color="#4F46E5"/>
        <SolidColorBrush x:Key="PrimaryHoverBrush" Color="#4338CA"/>
        <SolidColorBrush x:Key="BgBrush" Color="#F9FAFB"/>
        <SolidColorBrush x:Key="CardBrush" Color="White"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#E5E7EB"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#111827"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#4B5563"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#8B5CF6"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="#10B981"/>
        <SolidColorBrush x:Key="ErrorBrush" Color="#EF4444"/>

        <DropShadowEffect x:Key="SoftShadow" BlurRadius="15" ShadowDepth="2" Direction="270" Color="#000000" Opacity="0.05"/>

        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="20,10"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="8" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Opacity" Value="0.8"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SecondaryButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="8" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#F3F4F6"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#D1D5DB"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#E5E7EB"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ModernTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="border" CornerRadius="8" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                            <ScrollViewer x:Name="PART_ContentHost" Margin="0" Focusable="false"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                <Setter TargetName="border" Property="BorderThickness" Value="2"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="TabControl">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <Style TargetType="TabItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="24,12"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="8,8,0,0">
                            <ContentPresenter x:Name="contentPresenter" ContentSource="Header" Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="border" Property="Background" Value="White"/>
                                <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="TimelineSliderStyle" TargetType="Slider">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Slider">
                        <Grid x:Name="GridRoot" Background="Transparent" Height="40">
                            <Border Height="8" Background="#E5E7EB" VerticalAlignment="Center" CornerRadius="4"/>
                            <Track x:Name="PART_Track">
                                <Track.Thumb>
                                    <Thumb x:Name="Thumb" Width="1" Background="Transparent">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Rectangle Width="2" Fill="{StaticResource PrimaryBrush}" Height="40" VerticalAlignment="Center"/>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Global Header -->
            <RowDefinition Height="*"/>    <!-- Main Content -->
            <RowDefinition Height="Auto"/> <!-- Progress Footer -->
        </Grid.RowDefinitions>

        <!-- Global Header -->
        <Border Grid.Row="0" Background="White" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1" Padding="32,10">
            <DockPanel LastChildFill="False">
                <StackPanel DockPanel.Dock="Left" Orientation="Horizontal" VerticalAlignment="Center">
                    <Ellipse Width="24" Height="18" Fill="{StaticResource PrimaryBrush}" Margin="0,0,12,0"/>
                    <TextBlock Text="yShorts Studio" FontSize="18" FontWeight="Bold" Foreground="{StaticResource TextPrimary}"/>
                </StackPanel>
                
                <Button Style="{StaticResource SecondaryButton}" DockPanel.Dock="Right" Click="Settings_Click" Padding="10,4" FontSize="12" HorizontalAlignment="Right">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="⚙" Margin="0,0,6,0" FontSize="14" VerticalAlignment="Center"/>
                        <TextBlock Text="Settings" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </DockPanel>
        </Border>

        <Grid Grid.Row="1" Margin="32,16">
            <TabControl x:Name="MainTabs">
                <!-- ✂️ Manual Editor Tab -->
                <TabItem Header="Manual Editor">
                    <Grid Margin="0,16,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="320"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" Background="White" CornerRadius="16" Effect="{StaticResource SoftShadow}" Padding="24" Margin="0,0,24,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Grid Grid.Row="0">
                                    <Border x:Name="ManualDropZone" Background="{StaticResource BgBrush}" CornerRadius="12" 
                                            AllowDrop="True" Drop="ManualVideo_Drop" DragOver="ManualVideo_DragOver"
                                            Visibility="{Binding IsManualVideoLoaded, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=Invert}">
                                        <StackPanel VerticalAlignment="Center" MouseDown="ManualVideo_Click" Cursor="Hand">
                                            <TextBlock Text="" FontFamily="Segoe MDL2 Assets" FontSize="48" HorizontalAlignment="Center" Foreground="{StaticResource PrimaryBrush}"/>
                                            <TextBlock Text="Drag a video or click to browse" FontSize="16" FontWeight="SemiBold" Margin="0,16,0,0" HorizontalAlignment="Center" Foreground="{StaticResource TextSecondary}"/>
                                        </StackPanel>
                                    </Border>

                                    <Grid Visibility="{Binding IsManualVideoLoaded, Converter={StaticResource CountToVisibilityConverter}}">
                                        <Border Background="Black" CornerRadius="12" ClipToBounds="True" Height="450">
                                            <Grid x:Name="PreviewContainer" SizeChanged="PreviewContainer_SizeChanged">
                                                <MediaElement x:Name="ManualPreview" LoadedBehavior="Manual" UnloadedBehavior="Stop" ScrubbingEnabled="True"
                                                             MediaOpened="ManualPreview_MediaOpened" MediaEnded="ManualPreview_MediaEnded"/>

                                                <Canvas x:Name="CropCanvas" Background="Transparent">
                                                    <!-- WYSIWYG Dim Dimmers -->
                                                    <Border x:Name="DimLeft" Background="#AA000000" Canvas.Left="0" Canvas.Top="0"/>
                                                    <Border x:Name="DimRight" Background="#AA000000" Canvas.Top="0"/>
                                                    <Border x:Name="DimTop" Background="#AA000000" Canvas.Left="0" Canvas.Top="0"/>
                                                    <Border x:Name="DimBottom" Background="#AA000000" Canvas.Left="0"/>

                                                    <Border x:Name="CropFrame" Width="{Binding CropWidth, Mode=TwoWay}" Height="{Binding CropHeight, Mode=TwoWay}" 
                                                            BorderThickness="3" Background="Transparent" Cursor="SizeAll"
                                                            MouseDown="CropFrame_MouseDown" MouseMove="CropFrame_MouseMove" MouseUp="CropFrame_MouseUp" MouseWheel="CropFrame_MouseWheel">
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsVerticalRatio}" Value="True">
                                                                        <Setter Property="BorderBrush" Value="{StaticResource SuccessBrush}"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                        <Grid>
                                                            <!-- Grid Overlay -->
                                                            <Grid IsHitTestVisible="False" Opacity="0.2">
                                                                <Grid.ColumnDefinitions><ColumnDefinition/><ColumnDefinition/><ColumnDefinition/></Grid.ColumnDefinitions>
                                                                <Grid.RowDefinitions><RowDefinition/><RowDefinition/><RowDefinition/></Grid.RowDefinitions>
                                                                <Border Grid.Column="0" Grid.RowSpan="3" BorderBrush="White" BorderThickness="0,0,1,0"/>
                                                                <Border Grid.Column="1" Grid.RowSpan="3" BorderBrush="White" BorderThickness="0,0,1,0"/>
                                                                <Border Grid.Row="0" Grid.ColumnSpan="3" BorderBrush="White" BorderThickness="0,0,0,1"/>
                                                                <Border Grid.Row="1" Grid.ColumnSpan="3" BorderBrush="White" BorderThickness="0,0,0,1"/>
                                                            </Grid>
                                                            
                                                            <!-- Corners -->
                                                            <Border Width="16" Height="16" Background="White" BorderBrush="{Binding BorderBrush, RelativeSource={RelativeSource AncestorType=Border}}" BorderThickness="2" HorizontalAlignment="Right" VerticalAlignment="Bottom" Cursor="SizeNWSE" Margin="0,0,-8,-8" MouseDown="ResizeHandle_MouseDown" Tag="BottomRight" CornerRadius="8"/>
                                                            <Border Width="16" Height="16" Background="White" BorderBrush="{Binding BorderBrush, RelativeSource={RelativeSource AncestorType=Border}}" BorderThickness="2" HorizontalAlignment="Left" VerticalAlignment="Top" Cursor="SizeNWSE" Margin="-8,-8,0,0" MouseDown="ResizeHandle_MouseDown" Tag="TopLeft" CornerRadius="8"/>
                                                            <Border Width="16" Height="16" Background="White" BorderBrush="{Binding BorderBrush, RelativeSource={RelativeSource AncestorType=Border}}" BorderThickness="2" HorizontalAlignment="Right" VerticalAlignment="Top" Cursor="SizeNESW" Margin="0,-8,-8,0" MouseDown="ResizeHandle_MouseDown" Tag="TopRight" CornerRadius="8"/>
                                                            <Border Width="16" Height="16" Background="White" BorderBrush="{Binding BorderBrush, RelativeSource={RelativeSource AncestorType=Border}}" BorderThickness="2" HorizontalAlignment="Left" VerticalAlignment="Bottom" Cursor="SizeNESW" Margin="-8,0,0,-8" MouseDown="ResizeHandle_MouseDown" Tag="BottomLeft" CornerRadius="8"/>
                                                            <!-- Sides -->
                                                            <Border Width="8" Height="24" Background="White" BorderBrush="{Binding BorderBrush, RelativeSource={RelativeSource AncestorType=Border}}" BorderThickness="2" HorizontalAlignment="Left" VerticalAlignment="Center" Cursor="SizeWE" Margin="-4,0,0,0" MouseDown="ResizeHandle_MouseDown" Tag="Left" CornerRadius="4"/>
                                                            <Border Width="8" Height="24" Background="White" BorderBrush="{Binding BorderBrush, RelativeSource={RelativeSource AncestorType=Border}}" BorderThickness="2" HorizontalAlignment="Right" VerticalAlignment="Center" Cursor="SizeWE" Margin="0,0,-4,0" MouseDown="ResizeHandle_MouseDown" Tag="Right" CornerRadius="4"/>
                                                            <Border Width="24" Height="8" Background="White" BorderBrush="{Binding BorderBrush, RelativeSource={RelativeSource AncestorType=Border}}" BorderThickness="2" HorizontalAlignment="Center" VerticalAlignment="Top" Cursor="SizeNS" Margin="0,-4,0,0" MouseDown="ResizeHandle_MouseDown" Tag="Top" CornerRadius="4"/>
                                                            <Border Width="24" Height="8" Background="White" BorderBrush="{Binding BorderBrush, RelativeSource={RelativeSource AncestorType=Border}}" BorderThickness="2" HorizontalAlignment="Center" VerticalAlignment="Bottom" Cursor="SizeNS" Margin="0,0,0,-4" MouseDown="ResizeHandle_MouseDown" Tag="Bottom" CornerRadius="4"/>
                                                        </Grid>
                                                    </Border>
                                                </Canvas>
                                            </Grid>
                                        </Border>
                                    </Grid>
                                </Grid>

                                <StackPanel Grid.Row="1" Margin="0,20,0,0" Visibility="{Binding IsManualVideoLoaded, Converter={StaticResource CountToVisibilityConverter}}">
                                    <Grid x:Name="TimelineHitArea" Height="40" Background="Transparent"
                                          PreviewMouseLeftButtonDown="TimelineSlider_MouseDown"
                                          PreviewMouseMove="TimelineSlider_MouseMove"
                                          PreviewMouseLeftButtonUp="TimelineSlider_MouseUp">
                                        <Slider x:Name="TimelineSlider" Maximum="{Binding ManualVideoDuration}" Style="{StaticResource TimelineSliderStyle}" IsHitTestVisible="False"/>
                                        <Canvas IsHitTestVisible="False">
                                            <Rectangle x:Name="StartMarker" Fill="{StaticResource SuccessBrush}" Width="3" Height="40" Canvas.Top="0"/>
                                            <Rectangle x:Name="EndMarker" Fill="{StaticResource ErrorBrush}" Width="3" Height="40" Canvas.Top="0"/>
                                        </Canvas>
                                    </Grid>
                                    
                                    <DockPanel Margin="0,12,0,0">
                                        <Button Content="{Binding PlayPauseIcon}" FontFamily="Segoe MDL2 Assets" Style="{StaticResource ModernButton}" Width="60" Height="40" Click="PlayPause_Click" FontSize="20" DockPanel.Dock="Left"/>
                                        
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Content="Set Start" Style="{StaticResource SecondaryButton}" Click="SetStart_Click" Margin="0,0,8,0" Padding="16,6"/>
                                            <Button Content="Set End" Style="{StaticResource SecondaryButton}" Click="SetEnd_Click" Padding="16,6"/>
                                        </StackPanel>

                                        <TextBlock x:Name="TimeStatus" Text="00:00 / 00:00" Foreground="{StaticResource TextSecondary}" VerticalAlignment="Center" FontSize="14" FontWeight="SemiBold" DockPanel.Dock="Right" TextAlignment="Right"/>
                                    </DockPanel>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <StackPanel Grid.Column="1">
                            <Border Background="White" CornerRadius="16" Effect="{StaticResource SoftShadow}" Padding="20" Margin="0,0,0,24">
                                <StackPanel>
                                    <TextBlock Text="Clip Configuration" FontSize="16" FontWeight="Bold" Margin="0,0,0,16"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions><ColumnDefinition/><ColumnDefinition/></Grid.ColumnDefinitions>
                                        <StackPanel Margin="0,0,8,0">
                                            <TextBlock Text="Start (s)" FontSize="12" Foreground="{StaticResource TextSecondary}" Margin="0,0,0,4"/>
                                            <TextBox Text="{Binding ManualStartTime}" Style="{StaticResource ModernTextBox}"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                            <TextBlock Text="End (s)" FontSize="12" Foreground="{StaticResource TextSecondary}" Margin="0,0,0,4"/>
                                            <TextBox Text="{Binding ManualEndTime}" Style="{StaticResource ModernTextBox}"/>
                                        </StackPanel>
                                    </Grid>
                                    <Button Content="Change Video File" Style="{StaticResource SecondaryButton}" Click="ManualVideo_Click" Margin="0,16,0,0" HorizontalAlignment="Stretch"/>
                                </StackPanel>
                            </Border>

                            <!-- Aspect Ratio & Alignment Card -->
                            <Border Background="White" CornerRadius="16" Effect="{StaticResource SoftShadow}" Padding="20" Margin="0,0,0,24"
                                    Visibility="{Binding IsManualVideoLoaded, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="Editor Tools" FontSize="16" FontWeight="Bold" Margin="0,0,0,16"/>
                                    
                                    <TextBlock Text="Presets" FontSize="12" Foreground="{StaticResource TextSecondary}" Margin="0,0,0,8"/>
                                    <UniformGrid Columns="2" Margin="0,0,0,12">
                                        <Button Content="9:16 (Vertical)" Style="{StaticResource SecondaryButton}" Margin="0,0,4,0" Click="SetVertical_Click"/>
                                        <Button Content="16:9 (Wide)" Style="{StaticResource SecondaryButton}" Margin="4,0,0,0" Click="SetHorizontal_Click"/>
                                    </UniformGrid>

                                    <Button Content="Center Frame" Style="{StaticResource SecondaryButton}" HorizontalAlignment="Stretch" Click="CenterCrop_Click"/>
                                </StackPanel>
                            </Border>

                            <Button Click="ManualCutBtn_Click" Height="60" FontSize="16" IsEnabled="{Binding IsManualVideoLoaded}">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource ModernButton}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsVerticalRatio}" Value="True">
                                                <Setter Property="Content" Value="✂️ Export Vertical (Crop)"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding IsVerticalRatio}" Value="False">
                                                <Setter Property="Content" Value="✂️ Export Vertical (Blur)"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <!-- AI Generator Tab -->
                <TabItem Header="AI Generator">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <Grid Margin="0,16,0,0">
                            <Grid.ColumnDefinitions><ColumnDefinition Width="*"/><ColumnDefinition Width="300"/></Grid.ColumnDefinitions>
                            
                            <!-- Topic Input Card -->
                            <Border Grid.Column="0" Background="White" CornerRadius="16" Effect="{StaticResource SoftShadow}" Padding="32" Margin="0,0,24,24">
                                <StackPanel>
                                    <TextBlock Text="Video Subject" FontSize="18" FontWeight="Bold" Foreground="{StaticResource TextPrimary}" Margin="0,0,0,16"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions><ColumnDefinition Width="*"/><ColumnDefinition Width="Auto"/></Grid.ColumnDefinitions>
                                        <TextBox x:Name="TopicInput" Text="{Binding Topic, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource ModernTextBox}" Padding="16" FontSize="16" Visibility="{Binding IsAdvancedMode, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=Invert}"/>
                                        <TextBlock Text="Advanced mode active — use stages below" VerticalAlignment="Center" FontSize="16" FontStyle="Italic" Foreground="{StaticResource TextSecondary}" Visibility="{Binding IsAdvancedMode, Converter={StaticResource CountToVisibilityConverter}}"/>
                                        <Button Grid.Column="1" Content="Generate Magic" Style="{StaticResource ModernButton}" Margin="16,0,0,0" Click="GenerateBtn_Click" IsEnabled="{Binding CanGenerate}" Height="54" Padding="32,0"/>
                                    </Grid>
                                    <CheckBox Content="Advanced Mode (Manual Script Stages)" IsChecked="{Binding IsAdvancedMode}" Margin="0,16,0,0" Foreground="{StaticResource TextSecondary}"/>
                                    <StackPanel Margin="0,24,0,0" Visibility="{Binding IsAdvancedMode, Converter={StaticResource CountToVisibilityConverter}}">
                                        <ItemsControl ItemsSource="{Binding Stages}"><ItemsControl.ItemTemplate><DataTemplate>
                                            <Border Background="{StaticResource BgBrush}" CornerRadius="12" Padding="16" Margin="0,0,0,12"><Grid>
                                                <Grid.ColumnDefinitions><ColumnDefinition/><ColumnDefinition/><ColumnDefinition Width="Auto"/></Grid.ColumnDefinitions>
                                                <StackPanel Margin="0,0,12,0"><TextBlock Text="Goal" FontSize="11" FontWeight="Bold"/><TextBox Text="{Binding Goal}" Style="{StaticResource ModernTextBox}"/></StackPanel>
                                                <StackPanel Grid.Column="1" Margin="8,0,12,0"><TextBlock Text="Visuals" FontSize="11" FontWeight="Bold"/><TextBox Text="{Binding VisualSearch}" Style="{StaticResource ModernTextBox}"/></StackPanel>
                                                <Button Grid.Column="2" Content="" FontFamily="Segoe MDL2 Assets" FontSize="18" Foreground="{StaticResource ErrorBrush}" Background="Transparent" Click="RemoveStage_Click" Tag="{Binding}" VerticalAlignment="Center" Margin="0,12,0,0"/>
                                            </Grid></Border>
                                        </DataTemplate></ItemsControl.ItemTemplate></ItemsControl>
                                        <Button Content="+ Add Content Stage" Style="{StaticResource SecondaryButton}" HorizontalAlignment="Left" Click="AddStage_Click"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <!-- Sidebar: Style Studio -->
                            <StackPanel Grid.Column="1">
                                <Border Background="White" CornerRadius="16" Effect="{StaticResource SoftShadow}" Padding="20">
                                    <StackPanel>
                                        <TextBlock Text="Style Studio" FontSize="16" FontWeight="Bold" Margin="0,0,0,16"/>
                                        <TextBlock Text="Mood" FontSize="12" FontWeight="Bold" Margin="0,0,0,6"/><ComboBox ItemsSource="{Binding Moods}" SelectedItem="{Binding SelectedMood}" Margin="0,0,0,16"/>
                                        <TextBlock Text="Subtitles" FontSize="12" FontWeight="Bold" Margin="0,0,0,6"/><ComboBox ItemsSource="{Binding SubtitleStyles}" SelectedItem="{Binding SelectedSubtitleStyle}"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Grid>
                    </ScrollViewer>
                </TabItem>

                <!-- Activity Log Tab (Consolidated Result) -->
                <TabItem Header="Activity Log" x:Name="LogTab">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="0,16,0,0">
                            <!-- SEO & Result Card -->
                            <Border Background="White" CornerRadius="16" Effect="{StaticResource SoftShadow}" Padding="32" Margin="0,0,0,24" Visibility="{Binding ResultVisible}">
                                <StackPanel>
                                    <TextBlock Text="Success! Your video is ready." FontSize="20" FontWeight="Bold" Foreground="{StaticResource SuccessBrush}" Margin="0,0,0,24"/>
                                    <Grid Margin="0,0,0,24">
                                        <Grid.ColumnDefinitions><ColumnDefinition Width="*"/><ColumnDefinition Width="Auto"/></Grid.ColumnDefinitions>
                                        <StackPanel><TextBlock Text="Viral Title" FontSize="13" FontWeight="Bold"/><TextBox Text="{Binding SeoTitle}" IsReadOnly="True" Style="{StaticResource ModernTextBox}" Margin="0,8,0,0"/></StackPanel>
                                        <Button Grid.Column="1" Content="Open Video" Style="{StaticResource ModernButton}" Margin="16,20,0,0" Click="PlayVideo_Click"/>
                                    </Grid>
                                    <TextBlock Text="SEO Description" FontSize="13" FontWeight="Bold"/><TextBox Text="{Binding SeoDescription}" IsReadOnly="True" Style="{StaticResource ModernTextBox}" Height="100" TextWrapping="Wrap" Margin="0,8,0,0"/>
                                </StackPanel>
                            </Border>

                            <Border Background="White" CornerRadius="16" Effect="{StaticResource SoftShadow}" Padding="24" Margin="0,0,0,24">
                                <Grid>
                                    <Grid.RowDefinitions><RowDefinition Height="Auto"/><RowDefinition Height="*"/></Grid.RowDefinitions>
                                    <DockPanel Margin="0,0,0,16" LastChildFill="False">
                                        <TextBlock Text="Studio Activity" FontSize="18" FontWeight="Bold" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center"/>
                                        <Button Content="Copy Log" Style="{StaticResource SecondaryButton}" Click="CopyLog_Click" DockPanel.Dock="Right" Padding="10,4" FontSize="12" HorizontalAlignment="Right" Margin="8,0,0,0"/>
                                        <Button Content="Clear" Style="{StaticResource SecondaryButton}" Click="ClearLog_Click" DockPanel.Dock="Right" Padding="10,4" FontSize="12" HorizontalAlignment="Right"/>
                                    </DockPanel>
                                    <Border Grid.Row="1" Background="{StaticResource BgBrush}" CornerRadius="12" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" MinHeight="400">
                                        <ScrollViewer x:Name="LogScroller" Padding="16"><TextBlock Text="{Binding LogText}" FontSize="13" Foreground="{StaticResource TextSecondary}" TextWrapping="Wrap" FontFamily="Consolas, monospace"/></ScrollViewer>
                                    </Border>
                                </Grid>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
            </TabControl>
        </Grid>

        <!-- Footer -->
        <Border Grid.Row="2" Background="White" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0" Padding="32,16" Visibility="{Binding ProgressVisible}">
            <Grid>
                <Grid.ColumnDefinitions><ColumnDefinition Width="Auto"/><ColumnDefinition Width="*"/><ColumnDefinition Width="Auto"/></Grid.ColumnDefinitions>
                <TextBlock Text="{Binding CurrentStep}" FontWeight="SemiBold" Foreground="{StaticResource PrimaryBrush}" VerticalAlignment="Center" Margin="0,0,24,0"/>
                <ProgressBar Grid.Column="1" Value="{Binding ProgressPercent}" Height="10" BorderThickness="0" Background="#F3F4F6" Foreground="{StaticResource PrimaryBrush}"><ProgressBar.Clip><RectangleGeometry RadiusX="5" RadiusY="5" Rect="0,0,2000,10"/></ProgressBar.Clip></ProgressBar>
                <TextBlock Grid.Column="2" Text="{Binding ProgressPercent, StringFormat={}{0}%}" FontWeight="Bold" Margin="24,0,0,0" VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>
</Window>
