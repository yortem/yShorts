<Window x:Class="yShorts.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:yShorts.Converters"
        Title="yShorts â€” Vertical Video Generator"
        Icon="favicon.ico"
        Width="900" Height="900"
        MinWidth="700" MinHeight="600"
        WindowStartupLocation="CenterScreen"
        Background="#0D0D0D">

    <Window.Resources>
        <conv:CountToVisibilityConverter x:Key="CountToVisibilityConverter"/>
        <!-- Accent color brush -->
        <SolidColorBrush x:Key="AccentBrush" Color="#8B5CF6"/>
        <SolidColorBrush x:Key="AccentHoverBrush" Color="#A78BFA"/>
        <SolidColorBrush x:Key="SurfaceBrush" Color="#1A1A2E"/>
        <SolidColorBrush x:Key="Surface2Brush" Color="#16213E"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#2A2A4A"/>
        <SolidColorBrush x:Key="TextBrush" Color="#E2E8F0"/>
        <SolidColorBrush x:Key="TextDimBrush" Color="#94A3B8"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="#22C55E"/>
        <SolidColorBrush x:Key="ErrorBrush" Color="#EF4444"/>

        <!-- TextBox Style -->
        <Style x:Key="DarkTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="#111827"/>
            <Setter Property="Foreground" Value="#E2E8F0"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="CaretBrush" Value="#E2E8F0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="border" CornerRadius="8"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ScrollViewer x:Name="PART_ContentHost" Margin="0" Focusable="false"
                                          HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Hidden"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Generate Button Style -->
        <Style x:Key="GenerateButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="24,12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#7C3AED"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Secondary Button Style -->
        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextDimBrush}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Padding" Value="14,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#1A1A2E"/>
                                <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#4B5563"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Header -->
                <RowDefinition Height="Auto"/> <!-- Input -->
                <RowDefinition Height="Auto"/> <!-- Manual Clips -->
                <RowDefinition Height="Auto"/> <!-- Progress -->
                <RowDefinition Height="Auto"/> <!-- Log -->
                <RowDefinition Height="Auto"/> <!-- Bottom Bar -->
            </Grid.RowDefinitions>

            <!-- Header -->
            <DockPanel Grid.Row="0" Margin="0,0,0,20">
                <Button Content="âš™ Settings"
                        Style="{StaticResource SecondaryButton}"
                        Click="Settings_Click"
                        DockPanel.Dock="Right"
                        VerticalAlignment="Top"
                        Margin="0,4,0,0"/>
                <StackPanel DockPanel.Dock="Left">
                    <TextBlock Text="âš¡ yShorts"
                               FontSize="28" FontWeight="Bold"
                               Foreground="{StaticResource AccentBrush}"/>
                    <TextBlock Text="Generate vertical videos from any topic â€” powered by AI, Pexels &amp; FFmpeg"
                               FontSize="13" Foreground="{StaticResource TextDimBrush}" Margin="0,4,0,0"/>
                </StackPanel>
            </DockPanel>

        <!-- Input Section -->
        <Border Grid.Row="1" Background="{StaticResource SurfaceBrush}"
                CornerRadius="12" Padding="20" Margin="0,0,0,16"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,8">
                    <TextBlock Text="Video Topic"
                               FontSize="13" FontWeight="SemiBold"
                               Foreground="{StaticResource TextDimBrush}"
                               VerticalAlignment="Center"/>
                    <CheckBox Content="Advanced Mode (Stages)" 
                              IsChecked="{Binding IsAdvancedMode}"
                              Foreground="{StaticResource TextDimBrush}"
                              FontSize="12" VerticalAlignment="Center"
                              Margin="20,0,0,0"/>
                </StackPanel>

                <Grid Grid.Row="1">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox x:Name="TopicInput"
                             Grid.Column="0"
                             Style="{StaticResource DarkTextBox}"
                             Text="{Binding Topic, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,0,12,0"
                             VerticalContentAlignment="Center"
                             Visibility="{Binding IsAdvancedMode, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=Invert}"/>
                    
                    <!-- Text for advanced mode -->
                    <TextBlock Grid.Column="0" Text="Stages defined below will be used to generate the script." 
                               Foreground="{StaticResource TextDimBrush}" FontStyle="Italic" FontSize="13"
                               VerticalAlignment="Center"
                               Visibility="{Binding IsAdvancedMode, Converter={StaticResource CountToVisibilityConverter}}"/>

                    <Button Grid.Column="1"
                             x:Name="GenerateBtn"
                             Content="ðŸš€ Generate Video"
                             Style="{StaticResource GenerateButton}"
                             Click="GenerateBtn_Click"
                             IsEnabled="{Binding CanGenerate}"/>

                    <!-- Stages List (Advanced Only) -->
                    <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Margin="0,16,0,0"
                                Visibility="{Binding IsAdvancedMode, Converter={StaticResource CountToVisibilityConverter}}">
                        <ItemsControl ItemsSource="{Binding Stages}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{StaticResource Surface2Brush}" CornerRadius="8" Padding="12" Margin="0,0,0,10" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Margin="0,0,8,0">
                                                <TextBlock Text="Narrative Goal" FontSize="11" Foreground="{StaticResource TextDimBrush}" Margin="0,0,0,4"/>
                                                <TextBox Text="{Binding Goal}" Style="{StaticResource DarkTextBox}" Padding="8,6"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="1" Margin="0,0,8,0">
                                                <TextBlock Text="Visual Content" FontSize="11" Foreground="{StaticResource TextDimBrush}" Margin="0,0,0,4"/>
                                                <Grid>
                                                   <TextBox Text="{Binding VisualSearch}" Style="{StaticResource DarkTextBox}" Padding="8,6"
                                                            Visibility="{Binding HasLocalVideo, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=Invert}"/>
                                                   <Border Background="#1E1B4B" CornerRadius="4" Padding="6,2" 
                                                           Visibility="{Binding HasLocalVideo, Converter={StaticResource CountToVisibilityConverter}}">
                                                       <DockPanel>
                                                           <Button Content="Ã—" DockPanel.Dock="Right" Background="Transparent" Foreground="White" BorderThickness="0" Click="ClearStageVideo_Click" Tag="{Binding}"/>
                                                           <TextBlock Text="{Binding LocalVideoName}" Foreground="#A5B4FC" FontSize="11" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                                       </DockPanel>
                                                   </Border>
                                                </Grid>
                                             </StackPanel>
                                             <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                                 <Button Content="ðŸ“" Style="{StaticResource SecondaryButton}" Padding="8,4" Margin="0,0,8,0" Click="SelectStageVideo_Click" Tag="{Binding}" ToolTip="Attach local video for this stage"/>
                                                 <Button Content="Ã—" Background="Transparent" Foreground="{StaticResource ErrorBrush}" BorderThickness="0" FontSize="18" Click="RemoveStage_Click" Tag="{Binding}"/>
                                             </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <Button Content="+ Add Stage" Style="{StaticResource SecondaryButton}" 
                                HorizontalAlignment="Left" Click="AddStage_Click" Margin="0,4,0,0"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>

        <!-- Manual Clips Section -->
        <Border Grid.Row="2" Background="{StaticResource SurfaceBrush}"
                CornerRadius="12" Padding="20" Margin="0,0,0,16"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <DockPanel Grid.Row="0" Margin="0,0,0,12">
                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                        <TextBlock Text="ðŸ“ Manual Video Clips"
                                   FontSize="13" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextDimBrush}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,12,0"/>
                        <TextBlock Text="{Binding LocalClipsCount}"
                                   VerticalAlignment="Center"
                                   FontSize="12"
                                   Foreground="{StaticResource TextDimBrush}"
                                   Opacity="0.7"/>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right">
                        <Button Content="+ Add Clips"
                                Style="{StaticResource SecondaryButton}"
                                Click="AddLocalClips_Click"
                                Margin="0,0,8,0"/>
                        <Button Content="ðŸ—‘ï¸ Clear All"
                                Style="{StaticResource SecondaryButton}"
                                Click="ClearLocalClips_Click"
                                Visibility="{Binding HasLocalClips, Converter={StaticResource CountToVisibilityConverter}}"/>
                    </StackPanel>
                </DockPanel>

                <ItemsControl Grid.Row="1" ItemsSource="{Binding LocalClips}" Margin="0,4,0,0">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Margin="0,0,10,10" CornerRadius="6" Background="{StaticResource Surface2Brush}"
                                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                                    Width="100" Height="140" ClipToBounds="True">
                                <Grid>
                                    <Image Source="{Binding Thumbnail}" Stretch="UniformToFill" Opacity="0.8"/>
                                    <Border VerticalAlignment="Bottom" Background="#CC000000" Padding="4">
                                        <TextBlock Text="{Binding FileName}" FontSize="9" Foreground="White" 
                                                   TextTrimming="CharacterEllipsis" TextAlignment="Center"/>
                                    </Border>
                                    <Button VerticalAlignment="Top" HorizontalAlignment="Right"
                                            Background="#99EF4444" BorderThickness="0" Width="22" Height="22"
                                            Content="Ã—" Foreground="White" FontWeight="Bold"
                                            Click="RemoveClip_Click" Tag="{Binding}"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Grid>
        </Border>

        <!-- Progress Section -->
        <Border Grid.Row="3" Background="{StaticResource SurfaceBrush}"
                CornerRadius="12" Padding="20" Margin="0,0,0,16"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                Visibility="{Binding ProgressVisible}">
            <StackPanel>
                <DockPanel Margin="0,0,0,10">
                    <TextBlock Text="{Binding CurrentStep}"
                               FontSize="14" FontWeight="SemiBold"
                               Foreground="{StaticResource TextBrush}"
                               DockPanel.Dock="Left"/>
                    <TextBlock Text="{Binding ProgressPercent, StringFormat={}{0}%}"
                               FontSize="13" FontWeight="SemiBold"
                               Foreground="{StaticResource AccentBrush}"
                               HorizontalAlignment="Right"/>
                </DockPanel>

                <ProgressBar Value="{Binding ProgressPercent}"
                             Height="6" Maximum="100"
                             Background="#1E293B"
                             Foreground="{StaticResource AccentBrush}"
                             BorderThickness="0">
                    <ProgressBar.Clip>
                        <RectangleGeometry RadiusX="3" RadiusY="3"
                                           Rect="0,0,9999,6"/>
                    </ProgressBar.Clip>
                </ProgressBar>

                <!-- Step indicators -->
                <UniformGrid Columns="6" Margin="0,14,0,0">
                    <TextBlock Text="ðŸ¤– AI Script" FontSize="11"
                               Foreground="{Binding Step1Color}" HorizontalAlignment="Center"/>
                    <TextBlock Text="ðŸŽ¬ Videos" FontSize="11"
                               Foreground="{Binding Step2Color}" HorizontalAlignment="Center"/>
                    <TextBlock Text="ðŸ”Š Audio" FontSize="11"
                               Foreground="{Binding Step3Color}" HorizontalAlignment="Center"/>
                    <TextBlock Text="ðŸ“ Subtitles" FontSize="11"
                               Foreground="{Binding Step4Color}" HorizontalAlignment="Center"/>
                    <TextBlock Text="ðŸŽžï¸ Render" FontSize="11"
                               Foreground="{Binding Step5Color}" HorizontalAlignment="Center"/>
                    <TextBlock Text="âœ… Done" FontSize="11"
                               Foreground="{Binding Step6Color}" HorizontalAlignment="Center"/>
                </UniformGrid>
            </StackPanel>
        </Border>

        <!-- Log Output -->
        <Border Grid.Row="4" Background="{StaticResource Surface2Brush}"
                CornerRadius="12" Padding="16"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <DockPanel Grid.Row="0" Margin="0,0,0,10">
                    <TextBlock Text="ðŸ“‹ Log Output"
                               FontSize="13" FontWeight="SemiBold"
                               Foreground="{StaticResource TextDimBrush}"
                               DockPanel.Dock="Left"
                               VerticalAlignment="Center"/>
                    <Button Content="Clear"
                            Style="{StaticResource SecondaryButton}"
                            Click="ClearLog_Click"
                            DockPanel.Dock="Right"
                            HorizontalAlignment="Right"
                            Margin="8,0,0,0"/>
                    <Button Content="Copy Log"
                            Style="{StaticResource SecondaryButton}"
                            Click="CopyLog_Click"
                            DockPanel.Dock="Right"
                            HorizontalAlignment="Right"/>
                </DockPanel>

                <ScrollViewer Grid.Row="1" x:Name="LogScroller"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled">
                    <TextBlock x:Name="LogOutput"
                               Text="{Binding LogText}"
                               FontFamily="Cascadia Mono, Consolas, monospace"
                               FontSize="12"
                               Foreground="#94A3B8"
                               TextWrapping="Wrap"
                               Padding="4"/>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Bottom Bar -->
        <Border Grid.Row="5" Margin="0,16,0,0"
                Visibility="{Binding ResultVisible}">
            <StackPanel>
                <Border Background="#0F2E1B"
                        CornerRadius="10,10,0,0" Padding="16"
                        BorderBrush="#22C55E" BorderThickness="1,1,1,0">
                    <DockPanel>
                        <StackPanel DockPanel.Dock="Left" VerticalAlignment="Center">
                            <TextBlock Text="âœ… Video Complete!"
                                       FontSize="15" FontWeight="Bold"
                                       Foreground="{StaticResource SuccessBrush}"/>
                            <TextBlock Text="{Binding OutputFilePath}"
                                       FontSize="12" Foreground="{StaticResource TextDimBrush}"
                                       Margin="0,4,0,0" TextTrimming="CharacterEllipsis"
                                       MaxWidth="500"/>
                        </StackPanel>

                        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal"
                                    HorizontalAlignment="Right" VerticalAlignment="Center">
                            <Button Content="ðŸ“‚ Open Folder"
                                    Style="{StaticResource SecondaryButton}"
                                    Click="OpenFolder_Click"
                                    Margin="0,0,8,0"/>
                            <Button Content="â–¶ Play Video"
                                    Style="{StaticResource SecondaryButton}"
                                    Click="PlayVideo_Click"/>
                        </StackPanel>
                    </DockPanel>
                </Border>
                
                <Border Background="#1A1A2E" CornerRadius="0,0,10,10" Padding="16"
                        BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
                    <StackPanel>
                        <DockPanel Margin="0,0,0,8">
                            <TextBlock Text="ðŸ“± SEO Suggestions" FontSize="14" FontWeight="Bold" Foreground="{StaticResource TextBrush}"/>
                        </DockPanel>
                        
                        <TextBlock Text="Optimized Title" FontSize="11" Foreground="{StaticResource TextDimBrush}" Margin="0,0,0,2"/>
                        <DockPanel Margin="0,0,0,12">
                            <Button Content="ðŸ“‹ Copy" DockPanel.Dock="Right" Padding="8,2" FontSize="10" Style="{StaticResource SecondaryButton}" Click="CopyTitle_Click"/>
                            <TextBox Text="{Binding SeoTitle}" IsReadOnly="True" Style="{StaticResource DarkTextBox}" Padding="8,6" FontSize="12" Margin="0,0,8,0" Background="#111827"/>
                        </DockPanel>

                        <TextBlock Text="Description &amp; Hashtags" FontSize="11" Foreground="{StaticResource TextDimBrush}" Margin="0,0,0,2"/>
                        <DockPanel>
                            <Button Content="ðŸ“‹ Copy" DockPanel.Dock="Right" VerticalAlignment="Top" Padding="8,2" FontSize="10" Style="{StaticResource SecondaryButton}" Click="CopyDescription_Click"/>
                            <TextBox Text="{Binding SeoDescription}" IsReadOnly="True" Height="60" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" Style="{StaticResource DarkTextBox}" Padding="8,6" FontSize="12" Margin="0,0,8,0" Background="#111827"/>
                        </DockPanel>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Border>

        </Grid>
    </ScrollViewer>
</Window>
